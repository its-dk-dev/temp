<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=<device-width>, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <center>
      <form name="confirm_form">
        <div id="emi_message"> </div><br>
        <div id="otp_error"> </div><br>        
        <label>Please enter OTP</label><input type="text" placeholder="Please enter OTP" name="otp"/><br /><br />
        <input type="button" value="Submit" onclick="sendEmail()"/>
      </form>      
    </center>
  </body>
  <script>

        let urlParams = new URLSearchParams(window.location.search)
        let message = "Dear " + urlParams.get("fname") + "\n"
        message += "Thank you for your inquiry. A 4 digit verification number has been sent to your email: " +  urlParams.get("email") + ", Please enter in the following box and submit for confirmation"
        
        alert(message)

        var loan = urlParams.get("loan")
        let interst_rate=8.5
        let tenure=15
        let interest_rate_per_year=loan*8.5/100
        let emi_message = "Principle amount is: " + loan
        let totalEmiAmountPerYear = (loan/15) + interest_rate_per_year
        emi_message += "\nTotal interest rate with principle amount:"+ totalEmiAmountPerYear * 15;
        emi_message += "\nEstimeted EMI ammount for next 15 years is:"+totalEmiAmountPerYear;

        if(emi_message != "") {
            document.getElementById('emi_message').style.visibility = 'visible'
            document.getElementById('emi_message').innerHTML = emi_message
        }
        else {
            document.getElementById('emi_message').style.visibility = 'hidden'
        }

        let otp = Math.floor(Math.random() * 10000)
        console.log("OTP", otp)

        let attempt = 1;

         function sendEmail() {
            let formData = document.forms["confirm_form"]
            var otp_error = ""

            if(formData['otp'].value == "") {
              otp_error = "Please enter OTP"
            }
            else {
              if(attempt === 3) {
                otp_error = "Validation failed!!!"
                window.location.href = 'http://pixel6.co/notfound'
              }
              else {
                if(formData['otp'].value == otp) {
                  otp_error = "Validation successfull"
                  window.location.href = 'http://pixel6.co/'
                }
                else {
                  otp_error = "Please reenter" 
                  formData['otp'].value = ""   
                }   
              }
              attempt++
            }

            if(otp_error != "") {
                document.getElementById('otp_error').style.visibility = 'visible'
                document.getElementById('otp_error').innerHTML = otp_error
            }
            else {
                document.getElementById('otp_error').style.visibility = 'hidden'
            }
          }  
    </script>
</html>
